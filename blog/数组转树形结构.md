---
slug: array-to-tree-structure
date: 2021-11-15
title: 数组转树形结构
authors: [jack]
tags: [js, 前端]
---

### 下面是输入输出的效果

```js
let arr = [
  { id: 1, name: '保安镇' },
  { parentId: 1, id: 2, name: '水口村' },
  { parentId: 1, id: 4, name: '黄水村' },
  { parentId: 4, id: 10, name: '网格一' },
  { parentId: 4, id: 12, name: '网格二' },
  { parentId: 2, id: 21, name: '喀喀喀' },
  { parentId: 2, id: 22, name: '哈哈哈' }
]
let treeData = arrayToTree(arr, undefined)
console.log(treeData)
```

<!--truncate-->

```shell
[
  // 打印
  {
    id: 1,
    name: '保安镇',
    children: [
      {
        parentId: 1,
        id: 2,
        name: '水口村',
        children: [
          {
            parentId: 2,
            id: 21,
            name: '喀喀喀',
            children: []
          },
          {
            parentId: 2,
            id: 22,
            name: '哈哈哈',
            children: []
          }
        ]
      },
      {
        parentId: 1,
        id: 4,
        name: '黄水村',
        children: [
          {
            parentId: 4,
            id: 10,
            name: '网格一',
            children: []
          },
          {
            parentId: 4,
            id: 12,
            name: '网格二',
            children: []
          }
        ]
      }
    ]
  }
]
```

### 比较好理解的版本

```js
function arrayToTree(array, parentId) {
  const res = []
  array.forEach((el) => {
    if (el.parentId == parentId) {
      el.children = arrayToTree(array, el.id)
      res.push(el)
    }
  })
  return res
}
```

### 比较骚的版本

```js
function arrayToTree(array, parentId) {
  return array
    .filter((item) => item.parentId == parentId)
    .map((item) => ({ ...item, children: arrayToTree(array, item.id) }))
}
```

### 顺便获取树结构层数

```js
// 数组转树结构顺便获取树结构层数
export function arrayToTreeHasNum(array, parentId) {
  let layerNum = 0 // 层数
  function arrayToTree(array, parentId) {
    const res = []
    array.forEach((el) => {
      if (el.parentId == parentId) {
        const children = arrayToTree(array, el.id)
        if (children.length > 0) {
          layerNum++
          el.children = children
        }
        res.push(el)
      }
    })
    return res
  }
  return {
    arr: arrayToTree(array, parentId),
    layerNum
  }
}
```

### 通过原始数组，根据节点唯一值获取整个树页上某个信息的数组拼接

效果

```js
console.log(getTreeInfoById(arr, 'name', 'id', 'parentId', 21))
// [ '保安镇', '水口村', '喀喀喀' ]
```

实现

```js
// 树结构，通过原始数组，根据节点唯一值获取整个树页上某个信息的数组拼接
export function getTreeInfoById(arr, infoField, idField, parentIdFiled, id) {
  let newArr = []
  let data = arr.find((el) => el[idField] == id)
  newArr.unshift(data[infoField])
  if (data[parentIdFiled]) {
    newArr.unshift(
      ...getTreeInfoById(
        arr,
        infoField,
        idField,
        parentIdFiled,
        data[parentIdFiled]
      )
    )
  }
  return newArr
}
```
