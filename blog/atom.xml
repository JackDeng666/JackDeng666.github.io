<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.ying-land.top/blog</id>
    <title>Ying Blog Blog</title>
    <updated>2024-06-15T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.ying-land.top/blog"/>
    <subtitle>Ying Blog Blog</subtitle>
    <icon>https://blog.ying-land.top/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[nodejs 实现浏览器端的离线消息推送服务]]></title>
        <id>https://blog.ying-land.top/blog/node-web-push</id>
        <link href="https://blog.ying-land.top/blog/node-web-push"/>
        <updated>2024-06-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[要在网页上实现离线消息推送需要使用到 Web Push，Web Push 是一种在 Web 浏览器中向用户发送实时消息和离线消息的技术。当用户同意接收通知后，它允许网站向用户发送通知，即使用户没有打开或使用网站。这些消息将显示在用户的操作系统、浏览器或移动设备上，以吸引用户的注意并提供实时信息。这种技术主要依赖于 Service Worker：一个在浏览器后台运行的脚本，可以在用户没有打开网页的情况下响应事件。]]></summary>
        <content type="html"><![CDATA[<p>要在网页上实现离线消息推送需要使用到 Web Push，Web Push 是一种在 Web 浏览器中向用户发送实时消息和离线消息的技术。当用户同意接收通知后，它允许网站向用户发送通知，即使用户没有打开或使用网站。这些消息将显示在用户的操作系统、浏览器或移动设备上，以吸引用户的注意并提供实时信息。这种技术主要依赖于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">Service Worker</a>：一个在浏览器后台运行的脚本，可以在用户没有打开网页的情况下响应事件。</p>
<blockquote>
<p>注意：经过个人测试在 PC 和安卓设备上，Chrome 和 Edge 都能使用 Web Push 通知，在 iOS 设备上目前还不支持。</p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="web-push-推送流程">Web Push 推送流程<a href="https://blog.ying-land.top/blog/node-web-push#web-push-%E6%8E%A8%E9%80%81%E6%B5%81%E7%A8%8B" class="hash-link" aria-label="Web Push 推送流程的直接链接" title="Web Push 推送流程的直接链接">​</a></h3>
<p>Web Push 推送流程可以分为以下步骤：</p>
<ul>
<li>Web 页面向浏览器请求推送权限。此时浏览器会向用户展示对应界面。</li>
<li>用户同意后，浏览器会生成一组订阅信息，并将此订阅信息跟请求推送的应用服务器关联起来，发给推送服务。</li>
<li>Web 应用将订阅信息连同用户的其他信息发送给应用服务器保存。</li>
<li>需要给用户推送消息时，应用服务器会按照 <a href="https://datatracker.ietf.org/doc/html/draft-ietf-webpush-protocol" target="_blank" rel="noopener noreferrer">web-push 协议</a> 的规范构造数据，然后发送给推送服务。</li>
<li>推送服务收到消息后做必要的鉴权，然后将消息发送给浏览器。</li>
<li>浏览器收到推送后展示提示信息，用户点击推送消息后会打开指定页面或者执行其他操作。</li>
</ul>
<p>省略掉一些兼容性的判断过程，最简化的整体逻辑如图所示：</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/01-f38faa8a6a00f55c59e075a858cc3185.png" width="1119" height="734" class="img_Zn7t"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="订阅消息">订阅消息<a href="https://blog.ying-land.top/blog/node-web-push#%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF" class="hash-link" aria-label="订阅消息的直接链接" title="订阅消息的直接链接">​</a></h2>
<p>假设用户启用了通知，现在我们可以订阅推送服务：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">subscribe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 注册 service-worker.js 获取 ServiceWorkerRegistration 对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> registration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">serviceWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/service-worker.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">scope</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 发起推送订阅</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pushSubscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> registration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pushManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userVisibleOnly：</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">applicationServerKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"BHX-QQ4hyVUMudPeU6U8bqY-bDHYimt2jk5k00LEjoEaEq65A3IyLm3ZjST8WgTtqDQTX9PwWd-shduHJ-G89hw"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 将 pushSubscription 发送给应用后端服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上面的示例中，subscribe 方法接受 userVisibleOnly 参数，如果该参数为 true 但没有调用 Notification API 时，浏览器会弹出默认的提示框提示有应用程序在后台运行，确保每个消息都有匹配的通知。对于部分浏览器而言（如 Chrome for Android），该属性必须设置为 true，不然会报错。</p>
<p>订阅成功后，推送服务器返回订阅信息 pushSubscription 对象， pushSubscription 的结构如下：</p>
<div class="language-json codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-json codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "endpoint": "https://fcm.googleapis.com/fcm/send/dpH5lCsTSSM:APA91bHqjZxM0VImWWqDRN7U0a3AycjUf4O-byuxb_wJsKRaKvV_iKw56s16ekq6FUqoCF7k2nICUpd8fHPxVTgqLunFeVeB9lLCQZyohyAztTH8ZQL9WCxKpA6dvTG_TUIhQUFq_n",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "keys": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "p256dh": "BLQELIDm-6b9Bl07YrEuXJ4BL_YBVQ0dvt9NQGGJxIQidJWHPNa9YrouvcQ9d7_MqzvGS9Alz60SZNCG3qfpk=",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "auth": "4vQK-SvRAN5eo-8ASlrwA=="</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>pushSubscription 包含公钥和 endpointURL，应用服务器推送时可以使用公钥对消息加密，endpointURL 是由推送服务器生成包含唯一标识符的 URL，推送服务器通过它判断将消息发送到哪个客户端。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="使用-vapid">使用 VAPID<a href="https://blog.ying-land.top/blog/node-web-push#%E4%BD%BF%E7%94%A8-vapid" class="hash-link" aria-label="使用 VAPID的直接链接" title="使用 VAPID的直接链接">​</a></h3>
<p>在上文订阅推送 subscribe 方法中，还传入了一个 applicationServerKey 参数给推送服务，这个参数的作用是什么呢？</p>
<p>Web Push 协议出于用户隐私考虑，在应用和推送服务器之间没有进行强身份验证，这为用户应用和推送服务都带来了一定的风险。解决方案是对 Web Push 使用自主应用服务器标识（VAPID）协议，VAPID 规范允许应用服务器向推送服务器标识身份，推送服务器知道哪个应用服务器订阅了用户，并确保它也是向用户推送信息的服务器。使用 VAPID 服务过程很简单，通过几个步骤可以理解 VAPID 如何实现安全性。</p>
<p>应用服务器创建一对公钥/私钥，并将公钥提供给 Web App 客户端
当用户尝试订阅推送服务时，将公钥添加到 subscribe() 订阅方法中，公钥将被发送到推送服务保存。
应用服务器想要推送消息时，发送包含公钥和已经签名的 JSON Web 令牌到推送服务提供的 API，推送服务验证通过后，将信息推送至 Web App 客户端。
为了避免处理过多加密细节，在这里我们只需简单了解 VAPID 规范即可，因为目前已经有很多库来帮助开发者生成公钥，从而大大减少开发工作量。假设开发者使用 Node.js 作为服务端语言，那么可以通过安装 web-push 来协助生成公钥。</p>
<div class="language-bash codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-bash codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm install web-push</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后就可以通过命令行生成公钥和私钥了：</p>
<div class="language-bash codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-bash codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npx web-push generate-vapid-keys --json</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-json codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-json codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "publicKey": "BHX-QQ4hyVUMudPeU6U8bqY-bDHYimt2jk5k00LEjoEaEq65A3IyLm3ZjST8WgTtqDQTX9PwWd-shduHJ-G89hw",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "privateKey": "mm1xKO6SbqftnHnC0VGNiYpkgoMchIwdLIBDVh5zQIM"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="消息推送">消息推送<a href="https://blog.ying-land.top/blog/node-web-push#%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81" class="hash-link" aria-label="消息推送的直接链接" title="消息推送的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="后端服务推送消息">后端服务推送消息<a href="https://blog.ying-land.top/blog/node-web-push#%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF" class="hash-link" aria-label="后端服务推送消息的直接链接" title="后端服务推送消息的直接链接">​</a></h3>
<p>接下来我们来实现后端服务推送消息。正如前面所提到的那样，第三方推送服务是由浏览器决定的，因此可能存在不同的浏览器对应不一样的第三方推送服务，而不同的第三方推送服务所要求的后端配置也是不一样的，因此在开发的时候，需要针对不同浏览器的不同推送服务，开发不同的后端推送服务，当然也可以选择一些现成的跨平台推送方案，如 <a href="https://onesignal.com/" target="_blank" rel="noopener noreferrer">OneSignal</a>，这些跨平台推送方案已经集成好了多种浏览器的推送服务，使得开发者不再需要去关心不同浏览器的推送服务适配问题。</p>
<p>在这里我们演示一段基于 Chrome 浏览器的后端推送服务代码。Chrome 浏览器所对应的推送服务器为 Firebase 云服务（FCM），假设应用服务后端使用 Node.js，那么我们可以使用 <a href="https://www.npmjs.com/package/web-push" target="_blank" rel="noopener noreferrer">web-push</a> 库来实现后端向推送服务器发送消息的方法：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> webpush </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'web-push'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> vapidKeys </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'BHX-QQ4hyVUMudPeU6U8bqY-bDHYimt2jk5k00LEjoEaEq65A3IyLm3ZjST8WgTtqDQTX9PwWd-shduHJ-G89hw'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">privateKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mm1xKO6SbqftnHnC0VGNiYpkgoMchIwdLIBDVh5zQIM'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webpush</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setVapidDetails</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">'mailto:your-email@provider.com'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vapidKeys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publicKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vapidKeys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">privateKey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webpush</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setGCMAPIKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'&lt;Your GCM API Key Here&gt;'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pushMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pushSubscription</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> webpush</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendNotification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pushSubscription</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中 vapidKeys 就是前面生成的公钥和私钥，它们也可以通过 webpush.generateVAPIDKeys() 在程序运行时调用该函数生成。但需要注意的是，公钥和私钥只需要生成一次，后续直接使用生成好的值即可。生成的公钥和私钥需要传入 webpush.setVapidDetails() 函数中对 web-push 进行配置。</p>
<p>接着是 webpush.setGCMAPIKey()，这个函数需要传入 Firebase 云服务（FCM）申请到的 GCMAPIKey。</p>
<p>配置好之后，就可以使用 webpush.sendNotification() 方法推送消息了。该方法第一个参数需要传入 pushSubscription，也就是推送订阅的最后一步中，浏览器向后端服务发送的 pushSubscription 对象。</p>
<p>后端服务在存储 pushSubscription 的时候，需要做好用户信息与 pushSubscription 的映射关系，这样，后续想要给哪个用户推送消息，只需要获取对应的 pushSubscription 即可。</p>
<p>sendNotification() 方法传入的第二个参数就是想要推送给用户的信息，它可以是字符串、或者 node Buffer。比如我们可以通过 JSON.stringify(obj) 的方式来向浏览器推送一个对象信息：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">webpush</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendNotification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pushSubscription</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Hello World!'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://www.baidu.com'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="浏览器接收推送消息">浏览器接收推送消息<a href="https://blog.ying-land.top/blog/node-web-push#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8E%A5%E6%94%B6%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF" class="hash-link" aria-label="浏览器接收推送消息的直接链接" title="浏览器接收推送消息的直接链接">​</a></h3>
<p>在完成推送订阅之后，浏览器与推送服务器建立了通信，此时浏览器可以在 Service Worker 通过监听 push 事件来接收推送服务发送的消息。</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'push'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'push event:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">showNotification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>消息通过事件回调下面的 data 属性获取。data 提供了以下方法来实现不同类型的消息进行解析：</p>
<ul>
<li>arrayBuffer()：将消息解析成 ArrayBuffer 对象；</li>
<li>blob()：将消息解析成 Blob 对象；</li>
<li>json()：将消息解析成 JSON 对象；</li>
<li>text()：将消息解析成字符串；</li>
</ul>
<p>需要注意的是，当推送服务器推送的消息没有任何数据时，data 属性可能为空，因此需要做好代码容错。</p>
<p>消息弹框点击事件：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'notificationclick'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'notificationclick event:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">notification</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">notification</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clients</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">openWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="取消订阅">取消订阅<a href="https://blog.ying-land.top/blog/node-web-push#%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85" class="hash-link" aria-label="取消订阅的直接链接" title="取消订阅的直接链接">​</a></h3>
<p>当网站在完成推送订阅之后，Web Push API 也提供了相应的方法来取消订阅。前面提到推送订阅成功之后 PushManager.subscribe() 方法返回的 pushSubscription 对象上有一个 unsubscribe() 就是用来取消订阅的：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">pushSubscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'取消订阅成功！'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在取消订阅之前，我们可以通过 PushManager.getSubscription() 方法来判断用户是否已经订阅，如果用户已经订阅过，那么该函数会返回 pushSubscription 对象，这样接下来再调用 unsubscribe() 方法最终取消订阅。完整的代码如下所示：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">registration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pushManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getSubscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pushSubscription</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">pushSubscription</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 用户尚未订阅</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 取消订阅</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> pushSubscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="前端" term="前端"/>
        <category label="js" term="js"/>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[nestjs 接入 stripe webhook 遇到的问题]]></title>
        <id>https://blog.ying-land.top/blog/nestjs-stripe</id>
        <link href="https://blog.ying-land.top/blog/nestjs-stripe"/>
        <updated>2024-04-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[nestjs 接入 stripe webhook 时，官方提供的 api stripe.webhooks.constructEvent 需要传入原始请求体才能成功解析出数据，而 nestjs 到达 controller 是默认是没把原始请求体返回的，所以需要做一些配置。]]></summary>
        <content type="html"><![CDATA[<p>nestjs 接入 stripe webhook 时，官方提供的 api <code>stripe.webhooks.constructEvent</code> 需要传入原始请求体才能成功解析出数据，而 nestjs 到达 controller 是默认是没把原始请求体返回的，所以需要做一些配置。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="修改入口文件">修改入口文件<a href="https://blog.ying-land.top/blog/nestjs-stripe#%E4%BF%AE%E6%94%B9%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6" class="hash-link" aria-label="修改入口文件的直接链接" title="修改入口文件的直接链接">​</a></h3>
<p>把 <code>NestFactory.create</code> 的第二个参数的 <code>rawBody</code> 设置为 true。</p>
<div class="language-ts codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-ts codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> NestFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-function function" style="color:#d73a49">create</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">NestExpressApplication</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AppModule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rawBody</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="controller-处获取-rawbody">controller 处获取 rawBody<a href="https://blog.ying-land.top/blog/nestjs-stripe#controller-%E5%A4%84%E8%8E%B7%E5%8F%96-rawbody" class="hash-link" aria-label="controller 处获取 rawBody的直接链接" title="controller 处获取 rawBody的直接链接">​</a></h3>
<p>直接使用 <code>RawBody</code> 参数装饰器即可。</p>
<div class="language-ts codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-ts codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RawBody </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@nestjs/common'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">PayController</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webhook'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">webhook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Headers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Stripe-Signature'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> signature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">RawBody</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> rawBody</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">handleWebhook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rawBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="nestjs" term="nestjs"/>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在1panel中启动MinIO并用Nginx反向代理为HTTPS连接]]></title>
        <id>https://blog.ying-land.top/blog/1panel-minio-nginx-reverse-proxy-https</id>
        <link href="https://blog.ying-land.top/blog/1panel-minio-nginx-reverse-proxy-https"/>
        <updated>2024-01-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[启动 minio 并配置 HTTPS]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="启动-minio-并配置-https">启动 minio 并配置 HTTPS<a href="https://blog.ying-land.top/blog/1panel-minio-nginx-reverse-proxy-https#%E5%90%AF%E5%8A%A8-minio-%E5%B9%B6%E9%85%8D%E7%BD%AE-https" class="hash-link" aria-label="启动 minio 并配置 HTTPS的直接链接" title="启动 minio 并配置 HTTPS的直接链接">​</a></h3>
<p>在 1panel 中启动 minio 可以去应用商店直接启动，也可以自己通过 docker 命令去启动，通过命令启动可以查看<a href="https://blog.ying-land.top/docs/docker/images/minio">这篇文章</a>。</p>
<p>此时启动完成后，直接通过 ip 去访问后台和在代码里连接 api 服务都是没问题的，那么接下来就开始配置 nginx 的反向代理。</p>
<p>在 1panel 中的话直接通过创建网站即可配置。</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/01-642e4b9efe01ee5dc426b0a9ee6de911.png" width="2118" height="1238" class="img_Zn7t"></p>
<p>地址要选择 MinIO 服务的地址。</p>
<p>创建好网站后，在列表里点击配置，然后点击 HTTPS -&gt; 启动 HTTPS，选好对应的证书即可开启 HTTPS。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="node-客户端无法连接的问题">node 客户端无法连接的问题<a href="https://blog.ying-land.top/blog/1panel-minio-nginx-reverse-proxy-https#node-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98" class="hash-link" aria-label="node 客户端无法连接的问题的直接链接" title="node 客户端无法连接的问题的直接链接">​</a></h3>
<p>这时候问题来了，在代码里改成 HTTPS 连接 MinIO 后出现了报错，<code>S3Error: Valid and authorized credentials required</code>。</p>
<p>我通过对比 MinIO 官方文档的反向代理配置和 1panel 默认生成的反向代理配置的异同测试了很多遍都不行。</p>
<p><a href="https://min.io/docs/minio/linux/integrations/setup-nginx-proxy-with-minio.html" target="_blank" rel="noopener noreferrer">英文 MinIO Nginx 反向代理</a></p>
<p><a href="https://www.minio.org.cn/docs/minio/linux/integrations/setup-nginx-proxy-with-minio.html" target="_blank" rel="noopener noreferrer">中文 MinIO Nginx 反向代理</a></p>
<p>最后加上了一个 <code>proxy_cache_convert_head off;</code> 就解决了。</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/02-e6b75766f33460bcd488e059129399b6.png" width="1478" height="798" class="img_Zn7t"></p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/03-d678f164290fc368411e504a6996aced.png" width="1013" height="1215" class="img_Zn7t"></p>
<p>似乎是 Nginx 反代时，这个配置启动会导致一些信息无法传递过去。</p>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="1panel" term="1panel"/>
        <category label="nginx" term="nginx"/>
        <category label="minio" term="minio"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在1panel中使用cloudflare的API申请Let's Encrypt的泛域ssl证书]]></title>
        <id>https://blog.ying-land.top/blog/1panel-get-universal-domain-ssl-certificate</id>
        <link href="https://blog.ying-land.top/blog/1panel-get-universal-domain-ssl-certificate"/>
        <updated>2024-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在 Cloudflare 中创建 DNS 令牌]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="在-cloudflare-中创建-dns-令牌">在 Cloudflare 中创建 DNS 令牌<a href="https://blog.ying-land.top/blog/1panel-get-universal-domain-ssl-certificate#%E5%9C%A8-cloudflare-%E4%B8%AD%E5%88%9B%E5%BB%BA-dns-%E4%BB%A4%E7%89%8C" class="hash-link" aria-label="在 Cloudflare 中创建 DNS 令牌的直接链接" title="在 Cloudflare 中创建 DNS 令牌的直接链接">​</a></h3>
<p>要在 1panel 中使用 cloudflare 的 API 申请 Let's Encrypt 的泛域 ssl 证书，首先要在 Cloudflare 中创建 DNS 令牌。</p>
<p>看 Cloudflare 的文档说明，发现有两种方式，第一种就是全局 API 密钥，它具有最大权限，可以执行任意操作，但如果泄漏的话风险就非常大，官方和 1panel 都不建议使用。第二种就是使用用户可自定义权限的 API 令牌，它可以按需给权限，将使用权限限定在指定的范围内，安全性较好，建议使用，即使泄漏也不影响全局。</p>
<p>获取令牌 token 具体方法如下：</p>
<ol>
<li>登录 Cloudflare，打开“用户 API 令牌”页面（<a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" rel="noopener noreferrer">https://dash.cloudflare.com/profile/api-tokens</a>），点击创建令牌；</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/01-da84d0275ed4594b3beac8782cc4215c.png" width="1670" height="565" class="img_Zn7t"></p>
<ol start="2">
<li>选择“编辑区域 DNS”，点击“使用模板”；</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/02-28d02497cd374bc7ac99c777a2493196.png" width="1071" height="1135" class="img_Zn7t"></p>
<ol start="3">
<li>
<p>在详细选项里，“权限”一栏中，依次选择“区域”——“DNS”——“编辑”，指定这个令牌只对编辑 DNS 生效；</p>
</li>
<li>
<p>在“区域资源”一栏中，如果选择“包括”——“所有区域”，token 将对所有域名都有权限操作，可以选择“特定区域”，然后指定固定的域名。</p>
</li>
<li>
<p>如果客户端的 IP 是固定的，可以在“客户端 IP 地址筛选”一栏中，指定客户端 IP，这样即使 token 外泄了，但因为客户端来源不在列表中，也不能访问；</p>
</li>
<li>
<p>“TTL”一栏中，可以指定这个令牌的生存周期，我要长期使用，所以不用理会；</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/03-ed7a18d05a8dca90801d80035c63e944.png" width="1391" height="1139" class="img_Zn7t"></p>
<p>继续下一步操作，就生成了所需的令牌了。</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/04-bd2cbe44222cd7cfe46337267aaef680.png" width="1147" height="950" class="img_Zn7t"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="在-1panel-中申请证书">在 1panel 中申请证书<a href="https://blog.ying-land.top/blog/1panel-get-universal-domain-ssl-certificate#%E5%9C%A8-1panel-%E4%B8%AD%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6" class="hash-link" aria-label="在 1panel 中申请证书的直接链接" title="在 1panel 中申请证书的直接链接">​</a></h3>
<p>先到 1panel 的 "网站" -&gt; "证书" 位置，创建好 Acme 账号和 DNS 账号，DNS 账号选 Cloudflare, 把刚刚申请好的 token 放进去即可。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="655" height="620" class="img_Zn7t"></p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="866" height="789" class="img_Zn7t"></p>
<p>然后点击申请证书，主域名填上对应的域名如，xxx.com，然后在其他域名里填上 *.xxx.com，这样就可以申请泛域名证书了，选择好 Acme 账号和 DNS 账号，最后点击确认即可。</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/07-cdf314495adb3da83dee3022449aacf9.png" width="1089" height="1234" class="img_Zn7t"></p>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="1panel" term="1panel"/>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 ssg 框架 docusaurus 生成站点并部署到 GithubPages]]></title>
        <id>https://blog.ying-land.top/blog/docusaurus-to-github-pages</id>
        <link href="https://blog.ying-land.top/blog/docusaurus-to-github-pages"/>
        <updated>2023-09-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[docusaurus 是一个 react 的 ssg 框架，可以生成静态博客，因此可以部署到许多免费的静态文件托管服务上，如 Github Pages、Vercel。]]></summary>
        <content type="html"><![CDATA[<p>docusaurus 是一个 react 的 ssg 框架，可以生成静态博客，因此可以部署到许多免费的静态文件托管服务上，如 Github Pages、Vercel。</p>
<p>并且 docusaurus 自带自动推送到 Github Pages 的部署命令，所以本篇文章记录一下用 Github Pages 部署的流程。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="github-仓库准备">github 仓库准备<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#github-%E4%BB%93%E5%BA%93%E5%87%86%E5%A4%87" class="hash-link" aria-label="github 仓库准备的直接链接" title="github 仓库准备的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="1-github-创建仓库">1. github 创建仓库<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#1-github-%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93" class="hash-link" aria-label="1. github 创建仓库的直接链接" title="1. github 创建仓库的直接链接">​</a></h3>
<p>注意仓库必须以 <code>&lt;github账号名&gt;.github.io</code> 命名。</p>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/img1-6b542496e48d02ef6716ac6992226b9e.png" width="1125" height="1104" class="img_Zn7t"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="2-把-docusaurus-项目推送到仓库">2. 把 docusaurus 项目推送到仓库<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#2-%E6%8A%8A-docusaurus-%E9%A1%B9%E7%9B%AE%E6%8E%A8%E9%80%81%E5%88%B0%E4%BB%93%E5%BA%93" class="hash-link" aria-label="2. 把 docusaurus 项目推送到仓库的直接链接" title="2. 把 docusaurus 项目推送到仓库的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m "first commit"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git branch -M main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git remote add origin git@github.com:&lt;github账号名&gt;/&lt;github账号名&gt;.github.io.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push -u origin main</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="3-新建分支-gh-pages">3. 新建分支 gh-pages<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#3-%E6%96%B0%E5%BB%BA%E5%88%86%E6%94%AF-gh-pages" class="hash-link" aria-label="3. 新建分支 gh-pages的直接链接" title="3. 新建分支 gh-pages的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/img2-91225e5a7a802e6f4f8bd44216c60888.png" width="548" height="409" class="img_Zn7t"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="4-设置部署分支">4. 设置部署分支<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#4-%E8%AE%BE%E7%BD%AE%E9%83%A8%E7%BD%B2%E5%88%86%E6%94%AF" class="hash-link" aria-label="4. 设置部署分支的直接链接" title="4. 设置部署分支的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://blog.ying-land.top/assets/images/img3-0c4dc5758e906e5c30b641b6bddb972e.png" width="1694" height="1071" class="img_Zn7t"></p>
<p>此时就可以通过连接 <code>https://&lt;github账号名&gt;.github.io</code> 访问到仓库 <code>&lt;github账号名&gt;.github.io</code> 的 <code>gh-pages</code> 分支里的内容。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="部署">部署<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#%E9%83%A8%E7%BD%B2" class="hash-link" aria-label="部署的直接链接" title="部署的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="1-修改-docusaurusconfigjs">1. 修改 docusaurus.config.js<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#1-%E4%BF%AE%E6%94%B9-docusaurusconfigjs" class="hash-link" aria-label="1. 修改 docusaurus.config.js的直接链接" title="1. 修改 docusaurus.config.js的直接链接">​</a></h3>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">docusaurus.config.js</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://&lt;github账号名&gt;.github.io'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">baseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">organizationName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'&lt;github账号名&gt;'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 填写用户名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">projectName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'&lt;github账号名&gt;.github.io'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 填写项目名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">deploymentBranch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'gh-pages'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 填写分支为gh-pages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="2-部署检查">2. 部署检查<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#2-%E9%83%A8%E7%BD%B2%E6%A3%80%E6%9F%A5" class="hash-link" aria-label="2. 部署检查的直接链接" title="2. 部署检查的直接链接">​</a></h3>
<p>观察 package.json</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">package.json</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"docusaurus"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"start"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus start"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus build"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"swizzle"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus swizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"deploy"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus deploy"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"clear"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus clear"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"serve"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"docusaurus serve"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在本地先打包，部署检查一下，看看会不会有问题：</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run serve</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="3-执行部署">3. 执行部署<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#3-%E6%89%A7%E8%A1%8C%E9%83%A8%E7%BD%B2" class="hash-link" aria-label="3. 执行部署的直接链接" title="3. 执行部署的直接链接">​</a></h3>
<p>没问题就直接部署</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm run deploy</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>等待执行完成后，打包后的内容将会被传到 <code>&lt;github账号名&gt;.github.io</code> 仓库的 <code>gh-pages</code> 分支里，浏览器输入 <code>https://&lt;github账号名&gt;.github.io</code> 网址就可以看到效果了。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="其他项目使用-github-pages">其他项目使用 GitHub Pages<a href="https://blog.ying-land.top/blog/docusaurus-to-github-pages#%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8-github-pages" class="hash-link" aria-label="其他项目使用 GitHub Pages的直接链接" title="其他项目使用 GitHub Pages的直接链接">​</a></h2>
<p>假如现在你有一个仓库名称叫 <code>a</code>，同时也开启了 GitHub Pages，那么你通过 <code>https://&lt;github账号名&gt;.github.io/a</code> 即可访问到项目 <code>a</code> 的内容，也就是说 <code>https://&lt;github账号名&gt;.github.io</code> 根目录的内容就是由 <code>&lt;github账号名&gt;.github.io</code> 仓库所决定的。</p>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="docusaurus" term="docusaurus"/>
        <category label="react" term="react"/>
        <category label="前端" term="前端"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[linux 查看、清理内存]]></title>
        <id>https://blog.ying-land.top/blog/linux-caches</id>
        <link href="https://blog.ying-land.top/blog/linux-caches"/>
        <updated>2022-03-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在 linux 上调试时，经常需要查看并清理内存，记录以下常用操作。]]></summary>
        <content type="html"><![CDATA[<p>在 linux 上调试时，经常需要查看并清理内存，记录以下常用操作。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="查看内存">查看内存<a href="https://blog.ying-land.top/blog/linux-caches#%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98" class="hash-link" aria-label="查看内存的直接链接" title="查看内存的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">free -h</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="linux-清理内存缓存命令">linux 清理内存缓存命令<a href="https://blog.ying-land.top/blog/linux-caches#linux-%E6%B8%85%E7%90%86%E5%86%85%E5%AD%98%E7%BC%93%E5%AD%98%E5%91%BD%E4%BB%A4" class="hash-link" aria-label="linux 清理内存缓存命令的直接链接" title="linux 清理内存缓存命令的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="清理-pagecache-缓存">清理 PageCache 缓存：<a href="https://blog.ying-land.top/blog/linux-caches#%E6%B8%85%E7%90%86-pagecache-%E7%BC%93%E5%AD%98" class="hash-link" aria-label="清理 PageCache 缓存：的直接链接" title="清理 PageCache 缓存：的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">sync &amp;&amp; echo 1 &gt; /proc/sys/vm/drop_caches</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="清理-dentries-和-inodes-缓存">清理 dentries 和 inodes 缓存：<a href="https://blog.ying-land.top/blog/linux-caches#%E6%B8%85%E7%90%86-dentries-%E5%92%8C-inodes-%E7%BC%93%E5%AD%98" class="hash-link" aria-label="清理 dentries 和 inodes 缓存：的直接链接" title="清理 dentries 和 inodes 缓存：的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">sync &amp;&amp; echo 2 &gt; /proc/sys/vm/drop_caches</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="清理-pagecachedentries-和-inodes-缓存">清理 PageCache、dentries 和 inodes 缓存：<a href="https://blog.ying-land.top/blog/linux-caches#%E6%B8%85%E7%90%86-pagecachedentries-%E5%92%8C-inodes-%E7%BC%93%E5%AD%98" class="hash-link" aria-label="清理 PageCache、dentries 和 inodes 缓存：的直接链接" title="清理 PageCache、dentries 和 inodes 缓存：的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">sync &amp;&amp; echo 3 &gt; /proc/sys/vm/drop_caches</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解释一下具体的操作含义：</p>
<p>sync：先执行 sync 同步命令，将文件系统缓存的数据立即写入磁盘，以防止数据丢失或损坏。</p>
<p>/proc/sys/vm/drop_caches：这是 Linux 的一个内核文件，用于清理虚拟内存。</p>
<p>请注意，清理缓存可能会对系统的性能和运行产生影响，请谨慎操作。在普通使用中，不建议频繁清理缓存，通常只需要等待系统自动进行内存管理和调度即可。</p>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[封装 vue 组件并发布到 npm]]></title>
        <id>https://blog.ying-land.top/blog/publish-vue-components-to-npm</id>
        <link href="https://blog.ying-land.top/blog/publish-vue-components-to-npm"/>
        <updated>2021-11-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本篇文章来研究一下如何封装 vue 组件并发布到 npm，然后在其他项目下载使用。]]></summary>
        <content type="html"><![CDATA[<p>本篇文章来研究一下如何封装 vue 组件并发布到 npm，然后在其他项目下载使用。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="1-项目初始化">1. 项目初始化<a href="https://blog.ying-land.top/blog/publish-vue-components-to-npm#1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="1. 项目初始化的直接链接" title="1. 项目初始化的直接链接">​</a></h3>
<p>首先，要创建项目，封装 vue 的插件，初始化 vue 工程一般用：
<code>vue create [项目名]</code>，但是我们要写的是一个简单的 vue 组件，不需要依赖那么多而庞大的配置，所以，这里我们用简版的 webapck 配置模板：</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">vue init webpack-simple [项目名]</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是因为用了 vue-cli 4 以上的版本（我是@vue/cli 4.5.15） ，报了个错</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">Command vue init requires a global addon to be installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please run yarn global add @vue/cli-init and try again.</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解决方法：</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -g @vue/cli-init</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后继续创建<code>vue init webpack-simple [项目名]</code>。</p>
<p>完成后安装依赖，启动项目</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run dev</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="2把组件写好并查看效果">2.把组件写好并查看效果<a href="https://blog.ying-land.top/blog/publish-vue-components-to-npm#2%E6%8A%8A%E7%BB%84%E4%BB%B6%E5%86%99%E5%A5%BD%E5%B9%B6%E6%9F%A5%E7%9C%8B%E6%95%88%E6%9E%9C" class="hash-link" aria-label="2.把组件写好并查看效果的直接链接" title="2.把组件写好并查看效果的直接链接">​</a></h3>
<p>此时编写组件就像平时写项目里封装组件一样，写好并查看效果，我这里写了个图片上传组件：</p>
<p><img decoding="async" loading="lazy" alt="图片1" src="https://blog.ying-land.top/assets/images/img1-a9aff15486c4199c459e60e741267724.png" width="232" height="448" class="img_Zn7t"></p>
<p>App.vue 里就正常引入查看效果：</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">src/App.vue</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">template</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"app"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div </span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"center"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">yingVueUpload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ref</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"upload"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        width</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'90px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        height</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'90px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">maxCount</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"9"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proBarColor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"#E10602"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uploadUrl</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"http://localhost:3033/nav/uploadImg"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">uploadCallBack</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"upCallBack"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">yingVueUpload</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"margin-top: 100px;"</span><span class="token plain"> @click</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"getData"</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      获取数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">template</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">yingVueUpload</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./ying-vue-upload'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 引入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">components</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yingVueUpload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'app'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">data</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">methods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$refs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'upload'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getDataList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">upCallBack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>觉得组件编写完成后，在组件目录下新建 index.js 文件，写入代码如下：</p>
<p><img decoding="async" loading="lazy" alt="图片2" src="https://blog.ying-land.top/assets/images/img2-3a9ea1b3541748656335afea56a30007.png" width="402" height="532" class="img_Zn7t"></p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">src/ying-vue-upload/index.js</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">component</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./index.vue'</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 引入当前组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Vue.js 的插件应当有一个公开方法 install 。第一个参数是 Vue 构造器，第二个参数是一个可选的选项对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 参考：https://cn.vuejs.org/v2/guide/plugins.html#%E5%BC%80%E5%8F%91%E6%8F%92%E4%BB%B6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 此处注意，组件需要添加name属性，代表注册的组件名称，也可以修改成其他的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//注册组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> component</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vue 的插件必须提供一个公开方法 install，该方法会在你使用该插件，也就是 Vue.use(yourPlugin)时被调用。这样也就给 Vue 全局注入了你的所有的组件。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="3修改配置项">3.修改配置项<a href="https://blog.ying-land.top/blog/publish-vue-components-to-npm#3%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E9%A1%B9" class="hash-link" aria-label="3.修改配置项的直接链接" title="3.修改配置项的直接链接">​</a></h3>
<p>我们只需单独打包编写好的 vue 组件即可，
修改 webpack.config.js ，主要是 entry,output</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">webpack.config.js</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'development'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./src/main.js'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./src/ying-vue-upload/index.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">// 开发模式编译整个项目查看组件效果，编译打包模式直接打包组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./dist'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">publicPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/dist/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'development'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'build.js'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ying-vue-upload.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 打包出的组件写个名称，到时package.json读取这个文件作为入口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">library</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ying-vue-upload'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 指定的就是你使用require时的模块名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里照写即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">libraryTarget</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'umd'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 指定输出格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">umdNamedDefine</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 会对 UMD 的构建过程中的 AMD 模块进行命名。否则就使用匿名的 define</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>原来在依赖里的 vue 移动到开发依赖</p>
<p><img decoding="async" loading="lazy" alt="图片3" src="https://blog.ying-land.top/assets/images/img3-986124799733b2747e81a2bce542771f.png" width="392" height="352" class="img_Zn7t"></p>
<p>修改完成后执行</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm run build</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>完成将生成 dist 文件夹，里面是编译后的组件代码。</p>
<p>修改 package.json 文件：</p>
<div class="language-json codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">package.json</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-json codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "private": false, // 发布开源需要将这个字段改为 false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "main": "dist/ying-vue-upload.js", // 指定入口文件， import xx 的时候它会去检索的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建<code>.npmignore</code>文件，上传到 npm 时，将忽略文件内定义的内容。</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_p0MT">npmignore</div><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_modules</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webpack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="4接下来直接发布组件到-npm">4.接下来直接发布组件到 npm<a href="https://blog.ying-land.top/blog/publish-vue-components-to-npm#4%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9B%B4%E6%8E%A5%E5%8F%91%E5%B8%83%E7%BB%84%E4%BB%B6%E5%88%B0-npm" class="hash-link" aria-label="4.接下来直接发布组件到 npm的直接链接" title="4.接下来直接发布组件到 npm的直接链接">​</a></h3>
<p>在 npm 官网注册账号，地址：<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">https://www.npmjs.com</a> ，注意邮箱要验证，会发送验证链接到你的注册邮箱，没有验证的话是不能发布代码的，看一下 package.json 中 author 尽量与 npm 账户一致。</p>
<p>在项目根目录下输入：</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm login</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后登录 npm 账号，输入用户名、密码、邮箱，完成后执行：</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm publish</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="5下载安装应用">5.下载安装，应用<a href="https://blog.ying-land.top/blog/publish-vue-components-to-npm#5%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8" class="hash-link" aria-label="5.下载安装，应用的直接链接" title="5.下载安装，应用的直接链接">​</a></h3>
<p>进入任意 vue 项目</p>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">npm install ying-vue-upload --save</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 main.js 中使用</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">myPlugin</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ying-vue-upload'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myPlugin</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="js" term="js"/>
        <category label="vue" term="vue"/>
        <category label="前端" term="前端"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[数组转树形结构，获取树结构数据信息]]></title>
        <id>https://blog.ying-land.top/blog/array-to-tree-structure</id>
        <link href="https://blog.ying-land.top/blog/array-to-tree-structure"/>
        <updated>2021-11-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[js 实现数组转树形结构的各种函数，实现通过原数组获取树结构数据信息。]]></summary>
        <content type="html"><![CDATA[<p>js 实现数组转树形结构的各种函数，实现通过原数组获取树结构数据信息。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="输入输出的效果">输入输出的效果<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E6%95%88%E6%9E%9C" class="hash-link" aria-label="输入输出的效果的直接链接" title="输入输出的效果的直接链接">​</a></h2>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'广东省'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'广州市'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'深圳市'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'荔湾区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'越秀区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'南山区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'宝安区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> toTreeV1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> toTreeV2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getTreeInfoById </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// let treeData = toTreeV1(0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// let treeData = toTreeV2(0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> treeData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">treeData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-shell codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "arr": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "id": 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "parentId": 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "广东省",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "layer": 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "children": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "id": 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "parentId": 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "name": "广州市",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "layer": 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "children": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "id": 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "parentId": 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "name": "荔湾区",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "layer": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "children": []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "id": 5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "parentId": 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "name": "越秀区",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "layer": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "children": []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "id": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "parentId": 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "name": "深圳市",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "layer": 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "children": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "id": 6,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "parentId": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "name": "南山区",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "layer": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "children": []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "id": 7,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "parentId": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "name": "宝安区",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "layer": 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "children": []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "layerNum": 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ '广东省', '广州市', '荔湾区' ]</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="实现">实现<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="实现的直接链接" title="实现的直接链接">​</a></h2>
<p>先创建一个高阶函数，到时候返回各种操作方法，高阶函数接收数组和数组元素里 id 的字段和 parentId 的字段。</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="数组转树结构-v1">数组转树结构 v1<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E6%95%B0%E7%BB%84%E8%BD%AC%E6%A0%91%E7%BB%93%E6%9E%84-v1" class="hash-link" aria-label="数组转树结构 v1的直接链接" title="数组转树结构 v1的直接链接">​</a></h3>
<p>实现一个 toTreeV1 函数，这个实现比较好理解</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeV1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="数组转树结构-v2">数组转树结构 v2<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E6%95%B0%E7%BB%84%E8%BD%AC%E6%A0%91%E7%BB%93%E6%9E%84-v2" class="hash-link" aria-label="数组转树结构 v2的直接链接" title="数组转树结构 v2的直接链接">​</a></h3>
<p>实现一个 toTreeV2 函数，这个实现代码较少</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeV2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="顺便获取树结构层数">顺便获取树结构层数<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E9%A1%BA%E4%BE%BF%E8%8E%B7%E5%8F%96%E6%A0%91%E7%BB%93%E6%9E%84%E5%B1%82%E6%95%B0" class="hash-link" aria-label="顺便获取树结构层数的直接链接" title="顺便获取树结构层数的直接链接">​</a></h3>
<p>顺便获取树结构层数</p>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> layerNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> layer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">layer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> layer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            layerNum</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">arr</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parentId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      layerNum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeHasLayer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="根据-id-获取整个树页的信息">根据 id 获取整个树页的信息<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E6%A0%B9%E6%8D%AE-id-%E8%8E%B7%E5%8F%96%E6%95%B4%E4%B8%AA%E6%A0%91%E9%A1%B5%E7%9A%84%E4%BF%A1%E6%81%AF" class="hash-link" aria-label="根据 id 获取整个树页的信息的直接链接" title="根据 id 获取整个树页的信息的直接链接">​</a></h3>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">id</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> infoField</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unshift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">infoField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unshift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token method function property-access" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> infoField</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getTreeInfoById</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_HMc6" id="完整代码">完整代码<a href="https://blog.ying-land.top/blog/array-to-tree-structure#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="完整代码的直接链接" title="完整代码的直接链接">​</a></h2>
<div class="language-js codeBlockContainer_VET9 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_KBVO"><pre tabindex="0" class="prism-code language-js codeBlock_K3Qt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_ceDy"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idField </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parentIdFiled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'parentId'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> layerNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parentId</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> layer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> parentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">layer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> layer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            layerNum</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">arr</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arrayToTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parentId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      layerNum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">id</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> infoField</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unshift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">infoField</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unshift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token method function property-access" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parentIdFiled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> infoField</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeV1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeV2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getTreeInfoById</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'广东省'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'广州市'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'深圳市'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'荔湾区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'越秀区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'南山区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">parentId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'宝安区'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> toTreeV1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> toTreeV2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getTreeInfoById </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">createTreeFns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// let treeData = toTreeV1(0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// let treeData = toTreeV2(0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> treeData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toTreeHasLayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">treeData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getTreeInfoById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_A0T6"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_I_OP" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_kZMZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lY18"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jack Deng</name>
            <uri>https://github.com/jackdeng666</uri>
        </author>
        <category label="js" term="js"/>
        <category label="前端" term="前端"/>
    </entry>
</feed>